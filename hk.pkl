amends "package://github.com/jdx/hk/releases/download/v1.28.0/hk@1.28.0#/Config.pkl"
import "package://github.com/jdx/hk/releases/download/v1.28.0/hk@1.28.0#/Builtins.pkl"

local linters = new Mapping<String, Step> {
  ["actionlint"] = Builtins.actionlint
  ["mise"] = Builtins.mise
  ["pkl"] = Builtins.pkl
  ["yamllint"] = Builtins.yamllint
  ["shfmt"] = Builtins.shfmt
  ["shellcheck"] = Builtins.shellcheck

  ["kubeconform"] {
    // Only validate ./clusters/ due to ./apps/ containing HelmReleases
    // with missing properties since they are used for patching
    glob = "clusters/*.yaml"
    check = "mise kubeconform:run {{ files }}"
  }

  ["kustomize"] {
    check = "mise kubeconform:kustomize"
  }
}

hooks {
  ["pre-commit"] {
    fix = true
    stash = true
    steps = linters
  }
  ["pre-push"] {
    steps = linters
  }
  ["fix"] {
    steps = linters
  }
  ["check"] {
    steps = linters
  }
}
